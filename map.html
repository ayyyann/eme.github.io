<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
        integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet-routing-machine/3.2.12/leaflet-routing-machine.min.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
        integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet-routing-machine/3.2.12/leaflet-routing-machine.min.js"></script>
    <link rel="stylesheet" href="css/style.css">
    <script defer src="js/index.js"></script>
    <script src="https://unpkg.com/feather-icons"></script>

    <title>Document</title>
    <style>
        html,
        body {
            padding: 0;
            margin: 0;
            overflow: hidden; /* Prevent scrolling */
        }

        #map {
            height: 100vh; /* Adjusted height */
            width: 100vw; /* Full width */
            z-index: 0;
        }

        .button-container {
            position: fixed;
            top: 10px;
            left: 10px;
            display: flex;
            justify-content: space-between; /* Space between buttons */
            width: calc(100% - 20px); /* Adjusted width */
            max-width: 600px; /* Max width for responsiveness */
            z-index: 1001; /* Set z-index higher than the map */
        }

        .round-button {
            background-color: rgba(255, 255, 255, 0.8);
            color: #333;
            border: none;
            border-radius: 15px; /* Adjusted border radius */
            padding: 4px 8px; /* Adjusted padding */
            cursor: pointer;
            font-size: 12px; /* Adjusted font size */
            margin: 0; /* Remove margin */
        }

        @media screen and (max-width: 768px) {
            .button-container {
                top: 10px;
                width: 80%;
                left: 15%;
            }

            .round-button {
                padding: 10px 12px;
                border-radius: 50px;
            }
        }
    </style>
</head>

<body>
    <div class="button-container">
        <button id="hospitalButton" class="round-button">Hospital</button>
        <button id="toiletButton" class="round-button">Toilet</button>
        <button id="medicalButton" class="round-button">Medical Shop</button>
        <button id="garageButton" class="round-button">Garage</button>
    </div>

    <div id="map"></div>

    <script>
        feather.replace();

        const map = L.map('map').setView([51.505, -0.09], 17);

        L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 19,
            attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
        }).addTo(map);

        let marker;
        let routingControl; // Declare routing control variable

        function success(pos) {
            const lat = pos.coords.latitude;
            const lng = pos.coords.longitude;

            // Remove existing marker
            if (marker) {
                map.removeLayer(marker);
            }

            // Add new draggable marker for live location
            marker = L.marker([lat, lng], { draggable: true }).addTo(map);
            map.setView([lat, lng], 14); // Set the view to the live location

            // Update live location when marker is dragged
            marker.on('dragend', function (event) {
                const newLatLng = event.target.getLatLng();
                map.setView(newLatLng, 13); // Set the view to the new location
            });
        }

        function error(err) {
            if (err.code === 1) {
                alert("Please allow geolocation access");
            } else {
                alert("Cannot get current location");
            }
        }

        // Function to handle double click on the map
        function handleMapDoubleClick(e) {
            const destination = e.latlng;

            // Clear existing routing control
            if (routingControl) {
                map.removeControl(routingControl);
            }

            // Create a new routing control and add it to the map
            routingControl = L.Routing.control({
                waypoints: [
                    L.latLng(marker.getLatLng()), // Start from live location
                    destination
                ],
                routeWhileDragging: true,
            position: 'bottomleft'
            }).addTo(map);
        }

        // Attach the double-click event listener to the map
        map.on('dblclick', handleMapDoubleClick);

        // Function to add marker at a specified location with custom icon and popup content
        function addMarker(location, iconUrl, name, phone, cost) {
            const customIcon = L.icon({
                iconUrl: iconUrl,
                iconSize: [32, 32], // Adjust size as needed
                iconAnchor: [16, 32], // Adjust anchor if necessary
                popupAnchor: [0, -32] // Adjust popup anchor if needed
            });

            const marker = L.marker(location, { icon: customIcon }).addTo(map);

            // Popup content
            const popupContent = `
                <b>Name:</b> ${name}<br>
                <b>Phone:</b> ${phone}<br>
                <b>Cost:</b> ${cost}
            `;

            marker.bindPopup(popupContent);
        }

        // Define custom icons for each location type
        const icons = {
            hospital: 'images/hospital-icon.png',
            toilet: 'toilet-icon.png',
            medical: 'medical-icon.png',
            garage: 'garage-icon.png'
        };

        // Define coordinates and details for each location type
        const locations = {
            hospital: [
                { coordinates: [19.231950950204823, 73.11875942733596], name: "Hospital 1", phone: "1234567890", cost: "$50" },
                { coordinates: [51.52, -0.11], name: "Hospital 2", phone: "1234567890", cost: "$50" }
                // Add more hospitals as needed
            ],
            toilet: [
                { coordinates: [19.23189016965419, 73.11807278184695], name: "Toilet 1", phone: "1234567890", cost: "$50" },
                { coordinates: [51.54, -0.13], name: "Toilet 2", phone: "1234567890", cost: "$50" }
                // Add more toilets as needed
            ],
            medical: [
                { coordinates: [19.23270057514642, 73.120132718314], name: "Medical Shop 1", phone: "1234567890", cost: "$50" },
                { coordinates: [19.23174834828191, 73.11972502255489], name: "Medical Shop 2", phone: "1234567890", cost: "$50" }
                // Add more medical shops as needed
            ],
            garage: [
                { coordinates: [51.57, -0.16], name: "Garage 1", phone: "1234567890", cost: "$50" },
                { coordinates: [51.58, -0.17], name: "Garage 2", phone: "1234567890", cost: "$50" }
                // Add more garages as needed
            ]
        };

        // Event listener for hospital button
        document.getElementById('hospitalButton').addEventListener('click', function() {
            clearMarkers(); // Clear existing markers
            addMarkers('hospital', locations.hospital);
        });

        // Event listener for toilet button
        document.getElementById('toiletButton').addEventListener('click', function() {
            clearMarkers(); // Clear existing markers
            addMarkers('toilet', locations.toilet);
        });

        // Event listener for medical shop button
        document.getElementById('medicalButton').addEventListener('click', function() {
            clearMarkers(); // Clear existing markers
            addMarkers('medical', locations.medical);
        });

        // Event listener for garage button
        document.getElementById('garageButton').addEventListener('click', function() {
            clearMarkers(); // Clear existing markers
            addMarkers('garage', locations.garage);
        });

        // Function to add markers for a specific location type
        function addMarkers(type, locs) {
            locs.forEach(loc => {
                addMarker(loc.coordinates, icons[type], loc.name, loc.phone, loc.cost);
            });
        }

        // Function to clear all markers from the map
        function clearMarkers() {
            map.eachLayer(layer => {
                if (layer instanceof L.Marker && layer !== marker) {
                    map.removeLayer(layer);
                }
            });
        }

        // Watch the user's geolocation and update the live location
        navigator.geolocation.watchPosition(success, error);
    
        document.querySelector(".nav-item").focus();
        var a = document.querySelector(".nav-item").lastChild.focus();
        function redirectToNextPage(nextPage) {
            // Redirect to the specified next page
            window.location.href = nextPage;
        }</script>
        <nav>
            <a class="nav-item" href="home.html">
                <i data-feather="home"></i><span>Home</span>
            </a>
    
            <a class="nav-item" href="map.html">
                <i data-feather="map-pin"></i><span>Map</span>
            </a>
    
            <a class="nav-item" href="chat.html">
                <i data-feather="message-square"></i><span>chat</span>
            </a>
        </nav>
</body>

</html>
